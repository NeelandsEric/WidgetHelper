{
  "widget_class": "Universal%20Value%20-%20Text",
  "widget_subclass": "126",
  "w_x": "`%XPOS%`",
  "w_y": "`%YPOS%`",
  "station": "",
  "io_id": "`%IO_ID%`",
  "code": "<script>\n\n//=================================================================================\n//======================       Supporting Functions     ===========================\n//=================================================================================\n// JavaScript Document\nvar reloaders = new Array();\n\nfunction stop_all_reloaders(name) {\n\t//name=strign de forma reloaders.panel_content_id_99\n\tvar i=0;\n\tif (typeof(eval(name))!='undefined') {\n\t\tvar reloader_obj=eval(name);\n\t\twhile (reloader_obj.length>0) {\n\t\t\t//clearTimeout(reloader_obj[reloader_obj.length-1]);\n\t\t\tclearInterval(reloader_obj[reloader_obj.length-1]);\n\t\t\treloader_obj.pop();\n\t\t\ti++;\n\t\t}\n\t}\n\treturn i;\n}\n\n\nfunction chech_auth(data) {\n\tif (data=='auth err') {\n\t\twindow.location.href='\\login.php';\n\t}\n}\n\n\nfunction get_gradient_color(color) {\n\tswitch(color)\n\t{\n\t/*case 'red':\n\t\treturn \"#F00-#500\";\n\t\tbreak;\n\tcase 'green':\n\t\treturn \"#0F0-#050\";\n\t\tbreak;\n\tcase 'blue':\n\t\treturn \"#ACF-#00C\";\n\t\tbreak;\n\tcase 'amber':\n\t\treturn \"#FE0-#440\";\n\t\tbreak;\n\tcase 'grey':\n\t\treturn \"#FFF-#555\";\n\t\tbreak;*/\n\tcase 'rosu':\n\tcase 'red':\n\t\treturn \"#F00-#500\";\n\t\tbreak;\n\tcase 'verde':\n\tcase 'green':\n\t\treturn \"#0F0-#050\";\n\t\tbreak;\n\tcase 'albastru':\n\tcase 'blue':\n\t\treturn \"#ACF-#00C\";\n\t\tbreak;\n\tcase 'chihlimbar':\n\tcase 'amber':\n\t\treturn \"#FE0-#440\";\n\t\tbreak;\n\tcase 'gri':\n\tcase 'grey':\n\t\treturn \"#FFF-#555\";\n\t\tbreak;\n\tcase 'turcoaz':\n\tcase 'turquoise':\n\tcase 'cyan':\n\tcase 'aqua':\n\tcase 'teal':\n\tcase 'aquamarine':\n\t\treturn \"#0FF-#055\";\n\t\tbreak;\n\tcase 'violet':\n\tcase 'purple':\n\tcase 'magenta':\n\tcase 'fuchsia':\n\t\treturn \"#F0F-#505\";\n\t\tbreak;\n\tcase 'galben':\n\tcase 'yellow':\n\t\treturn \"#FF0-#550\";\n\t\tbreak;\n\tcase 'orange':\n\tcase 'oranj':\n\tcase 'portocaliu':\n\t\treturn \"#F80-#FC9\";\n\t\tbreak;\n\tcase 'pink':\n\tcase 'roz':\n\t\treturn \"#F08-#F9C\";\n\t\tbreak;\n\tdefault:\n\t\treturn color; //gray\n\t}\n}\n\nfunction string_to_date(the_string,the_date) {\n\tvar the_str=the_string;\n\tvar the_dat=new Date(the_date*1000);\n\t//the_str=the_str.replace(\"D\",the_dat.getDate());\n\tthe_str=the_str.replace(\"D\",(\"0\"+the_dat.getDate()).slice(-2))\n\t//the_str=the_str.replace(\"M\",(the_dat.getMonth()+1));\n\tthe_str=the_str.replace(\"M\",(\"0\"+(the_dat.getMonth()+1)).slice(-2));\n\tthe_str=the_str.replace(\"Y\",the_dat.getFullYear());\n\tthe_str=the_str.replace(\"h\",(\"0\"+the_dat.getHours()).slice(-2));\n\tthe_str=the_str.replace(\"m\",(\"0\"+the_dat.getMinutes()).slice(-2));\n\tthe_str=the_str.replace(\"s\",(\"0\"+the_dat.getSeconds()).slice(-2));\n\tthe_str=the_str.replace(\"|\",\"\\n\");\n\treturn(the_str);\n}\n\nfunction prepare_url(url,io_id) {\n\t//poate fi apelat cu server=xxx si io_id=0 sau\n\t//cu server=xxx.php?io_id=0&xx=yy si io_id='' sau\n\t//cu server=xxx.php?xx=yy si io_id=0 sau\n\n\tif (url.indexOf('.php')==-1)\n\t\turl+='.php';\n\turl='/servers/'+url;\n\tif (String(io_id)!='') {\n\t\tif (url.indexOf('?')==-1)\n\t\t\t//nu are '?'\n\t\t\turl+='?';\n\t\telse\n\t\t\t//are '?'\n\t\t\turl+='&';\n\t\turl+='io_id='+io_id;\n\t}\n\treturn url;\n}\n\nfunction helpme_get_value(io_id, success_function) {\n\tjQuery.get( prepare_url('get_value',io_id), function(data){success_function(data);} );\n}\n\n\t\n//=================================================================================\n//====================       Function Text With Units     =========================\n//=================================================================================\t\n\t\n\tfunction textunit(holder,url,val_source,params) {\n\t//primeste date in forma value|um|error=0,1\n\t//sau value|um\n\t//sau value\n\n\tvar p={\n\t\t\"holder\" :holder,\n\t\t\"url\" :val_source,\n\t\t\"interval\":params.interval,\n\t\t\"value_span_style\":\"\",\n\t\t\"um_span_style\":\"padding-left:3px;\",\n\t\t\"err_span_style\":\"color:red;\"\n\t};\n\tjQuery.extend(p,params);\n\t// 10 second interval minimum\n\tif ((Number(p.interval)<=10000)) {\n\t\tp.interval=10000;\n\t}\n\tvar reload_obj=get_reloader_obj(holder);\n\tvar pos=get_reloader_pos(reload_obj);\n\treload_obj[pos]=setInterval(function(){\n\n\t\t\n        if (typeof(reloadersOverrideFlag)=='undefined' || !reloadersOverrideFlag) {\n\t\t\t//console.log(\"Interval unit update\");\n\t\t\tunit_update();\n\t\t}\n\t\t/*\n\t\tif (typeof(reloadersOverrideFlag)=='undefined' || !reloadersOverrideFlag){\n\t\t\tconsole.log(\"Interval update\");\n\t\t\tupdate();\n\t\t}*/\n\n\t},p.interval);\n\t\n\tvar val_update=function(data,unit){\n\n\t\t\tvar output = [0,'°C'];\n\t\t\tdata=data.split('|');\t\t\t\n\t\t\t//console.log(\"Unit \"+unit);\n\t\t\t//console.log(\"Data \"+data);\n\t\tif(data[1]=='F'){\n\t\t\tdata[1]= '°F';\n\t\t}else if(data[1] == 'C'){\n\t\t\tdata[1] = '°C';\n\t\t}\n\t\t\tif(data[1]=='°F'){\n\t\t\t\tif(unit==0){\n\t\t\t\t\toutput[0]=Math.round(10*(data[0]-32)/1.8)/10;\n\t\t\t\t\toutput[1]='°C';\n\t\t\t\t\t//console.log(\"Temp Conversion F to C\");\n\t\t\t\t\t//console.log(\"Converted \"+data[0]+data[1]+\" to \"+output[0]+output[1]);\n\t\t\t\t} else {\n\t\t\t\t\toutput[0]=data[0]\n\t\t\t\t\toutput[1]=data[1]\n\t\t\t\t}\n\t\t\t\t\n\t\t\t}else if(data[1]=='°C'){\n\t\t\t\tif(unit==1){\n\t\t\t\t\toutput[0]=Math.round(10*data[0]+32*1.8)/10;\n\t\t\t\t\toutput[1]='°F';\n\t\t\t\t\t//console.log(\"Temp Conversion C to F\");\n\t\t\t\t\t//console.log(\"Converted \"+data[0]+data[1]+\" to \"+output[0]+output[1]);\n\t\t\t\t} else {\n\t\t\t\t\toutput[0]=data[0]\n\t\t\t\t\toutput[1]=data[1]\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t//main span\n\t\t\th='<span style=\"'+p.value_span_style+'\">';\n\t\t\tif (data.length==3 && data[2]==1) {\n\t\t\t\t//error\n\t\t\t\th+='<span style=\"'+p.err_span_style+'\">'+output[0]+'</span>';\n\t\t\t\t//alertStatus.push(true);\n\t\t\t} else {\n\t\t\t\t//no error\n\t\t\t\th+=output[0];\n\t\t\t\t//alertStatus.pop();\n\t\t\t}\n\t\t\th+='</span>';\n\n\t\t\t//um span\n\t\t\tif (data.length>=2) {\n\t\t\t\th+='<span style=\"'+p.um_span_style+'\">';\n\t\t\t\tif (data.length==3 && data[2]==1) {\n\t\t\t\t\t//error\n\t\t\t\t\th+='<span style=\"'+p.err_span_style+'\">'+output[1]+'</span>';\n\t\t\t\t} else {\n\t\t\t\t\t//no error\n\t\t\t\t\th+=output[1];\n\t\t\t\t}\n\t\t\t\th+='</span>';\n\t\t\t}\n\t\t\tjQuery('#'+p.holder).html(h);\t\t\t\n\t}\n\t\n\t// Update the text field, if the unit checks out\n\tvar update=function(unit){\n\t\tif (typeof(val_source)=='number') {\t\t\t\n\t\t\tp.url= prepare_url(url,val_source);\n\t\t\t//console.log(\"Query: \"+p.url);\t\t\t\n\t\t\tjQuery.get(p.url, function(data){\t\t\t\t\n\t\t\t\tchech_auth(data);\t\t\t\t\n\t\t\t\tval_update(data,unit);\n\t\t\t});\n\t\t}\n\t}\n\t\n\t// Update the unit of temperature\n\t// 0 -> celsius\n\t// 1 -> fahrenheit\n\tvar unit_update=function(){\n\t\t// test\n\t\tvar units;\n\t\ttry{\n\t\t\tunits = global_TempType;\n\t\t} catch(e){\n\t\t\t//console.log(\"error finding global_TempType\");\n\t\t\tunits = 0;\n\t\t}\n\t\t\n\t\t// test\n\t\tupdate(units);\n\t\t/*\n\t\tif (typeof(units)=='number') {\n\t\t\tp.url2= prepare_url(url,units);\t\t\t\n\t\t\tjQuery.get(p.url2, function(unit){\n\t\t\t\tchech_auth(unit);\t\t\t\t\n\t\t\t\tunit=parseInt(unit[0]);\t\n\t\t\t\tconsole.log(\"Attempt to find global temp\");\t\t\t\t\n\t\t\t\tupdate(unit);\n\t\t\t});\n\t\t}*/\n\t}\n\t\n\t// Update the field for the first time\n\tunit_update();\t\n};\n\n\t\n</script>\n\n\n<span id=\"holder_1449154269\"></span>\n<script language=\"javascript\" type=\"text/javascript\">\n//=================================================================================\n//======================       Regular Widget Setup     ===========================\n//=================================================================================\n\n  var server='get_value';\n  var io_id=`%IO_ID%`;\n\tvar val_source=io_id;\n\tvar widget_help={\n\t\t\"main_help\":{\n\t\t\t\"ro\":\"Text pentru afișarea unei valori\",\n\t\t\t\"en\":\"Text for displaying a value\"\n\t\t},\n\t\t\"Font\":{\n\t\t\t\"ro\":\"Fontul textului<br/>&nbsp;Arial<br/>&nbsp;Lucida Sans Unicode<br/>&nbsp;Verdana\",\n\t\t\t\"en\":\"Text font<br/>&nbsp;Arial<br/>&nbsp;Lucida Sans Unicode<br/>&nbsp;Verdana\"\n\t\t},\n\t\t\"FontSize\":{\n\t\t\t\"ro\":\"Dimensiunea textului\",\n\t\t\t\"en\":\"Text size\",\n\t\t\t\"width\":\"30px\"\n\t\t},\n\t\t\"Color\":{\n\t\t\t\"ro\":\"Culoarea textului când citește o valoare validă\",\n\t\t\t\"en\":\"The text color when it reads a valid value\",\n\t\t\t\"width\":\"60px\"\n\t\t},\n\t\t\"ErrColor\":{\n\t\t\t\"ro\":\"Culoarea textului când apare o eroare\",\n\t\t\t\"en\":\"The text when an error appears\",\n\t\t\t\"width\":\"60px\"\n\t\t},\n\t\t\t\"UMFontSize\":{\n\t\t\t\"ro\":\"Culoarea textului când apare o eroare\",\n\t\t\t\"en\":\"Changes unit font size\",\n\t\t\t\"width\":\"30px\"\n\t\t}\n\t};\n\tvar color_pickers='Color,ErrColor';\n\tvar editable_params={\n\t\t\"interval\":15000,\n\t\t\"Font\":\"Arial\",\n\t\t\"FontSize\":15,\n\t\t\"Color\":\"#ffffff\",\n\t\t\"ErrColor\":\"ffffff\",\n\t\t\"UMFontSize\":15};\n\tvar params={\n    \"interval\":15000, \t\t\t//period of data request from server\n    \"value_span_style\":\"font-weight:bold; font-family:Arial; font-size:15px;\",\t\t//styling of the value text\n    \"um_span_style\":\"margin-left:2px; font-size:10px;\",\t//styling of the unity of measure text; we add a little space to the left of the um\n    \"err_span_style\":\"color:red;\"};\n\tparams.interval=editable_params.interval;\n\tparams.value_span_style+=\"font-family:\"+editable_params.Font+\";\";\n\tparams.value_span_style+=\"font-size:\"+editable_params.FontSize+\"px;\";\n\tparams.value_span_style+=\"color:\"+editable_params.Color+\";\";\n\tparams.um_span_style+=\"font-size:\"+editable_params.UMFontSize+\"px;\";\n\tparams.um_span_style+=\"color:\"+editable_params.Color+\";\";\n\tparams.err_span_style+=\"color:\"+editable_params.ErrColor+\";\";\n  new textunit('holder_1449154269', server, val_source, params);\n</script>"
}